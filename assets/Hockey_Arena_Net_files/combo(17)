YUI.add("mobile-app-upsell-view",function(e){var t="show-upsell-banner";e.namespace("Views")[this.name]=e.Base.create("mobile-app-upsell-view",e.FlickrView,[],{langBundles:["common","mobile"],initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.buildContainer(),this},buildContainer:function(){var e=this.appContext.getUA().os;return this.setContainerWithTemplate("mobile-app-upsell",{isAndroid:e==="android",isIOS:e==="ios"}),this},setRootViewAdditionalViewClasses:function(){var e=[],n=this.appContext.getUA().os;return e.push(n),e.push(t),this.set("rootViewAdditionalViewClasses",e),this},activate:function(){var t=this.get("container"),n=t.one(".close-banner"),r=t.one(".get-app"),i=this;return n&&this.registerEventHandler(i.addBannerEvent(n,"dism",i.dismissBanner.bind(i))),r&&this.registerEventHandler(i.addBannerEvent(r,"inst",i.installApp.bind(i))),e.rapidTracker.beacon(this.name,"app_promo_interstitial_shown",{section:"app-interstitial"}),this},addBannerEvent:function(e,t,n){var r=this;return e.on("click",function(e){e.preventDefault(),r.appContext.setCookie({cookieName:t,path:"/",cookieValue:!0,remove:!0}),r.fire("subviewViewEvent","removeUpsell"),n()})},dismissBanner:function(){if(navigator.cookieEnabled){e.rapidTracker.beacon(this.name,"cookies_off",{section:"app-interstitial"});return}var t=parseInt(this.appContext.getCookie("flaidisn"),10);!t||isNaN(t)?t=0:t+=1,e.rapidTracker.beacon(this.name,"app_promo_interstitial_dismissed"+(t>0?"_"+(t+1):""),{section:"app-interstitial"});var n;t<2?n=e.moment().add(3,"days").toDate():t===2?n=e.moment().add(7,"days").toDate():t===3&&(n=e.moment().add(20,"year").toDate()),this.appContext.setCookie({cookieName:"flaidisn",cookieValue:1,expires:n,remove:!0,path:"/"})},installApp:function(){var t=this.appContext.getUA().os,n=this.appContext.getUA().isWebview,r="photos/"+this.nsid+"/"+this.photoId,i=this;e.rapidTracker.beacon(this.name,"app_promo_interstitial_download",{section:"app-interstitial"}),this.appContext.setCookie({cookieName:"flaidis",cookieValue:1,expires:e.moment().add(20,"year").toDate(),remove:!0,path:"/"}),setTimeout(function(){e.use("mobile-actions-helper",function(e){e.MobileActionsHelper.redirectToAppOrStore({os:t,isWebview:n,pageURL:r,beacon:{name:"app_promo_banner_open",section:"appbanner"},viewName:i.name})})},250)}},{ATTRS:{}}),e.namespace("Views")[this.name].shouldShowBanner=function(e){var t=e.getCookie("dism")||e.getCookie("inst"),n=e.getUA().os,r=n==="ios"||n==="android";return!t&&r}},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-mobile-app-upsell"],langBundles:["common","mobile"]});
YUI.add("hermes-lang-mobile",function(e,t){e.Intl.add("hermes/mobile","en-US",{APP_IOS:["Flickr for iOS"],APP_ANDROID:["Flickr for Android"],APP_IOS_FREE:["Free in the App Store"],APP_ANDROID_FREE:["Free in the Google Play"],GET:["Get"],INSTALL:["Install"]})},"@VERSION@",{requires:["intl"]});
YUI.add("global-nav-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n,r;typeof t.enableBrowserUpgradeBanner=="undefined"&&(t.enableBrowserUpgradeBanner=!0),this.set("showBrowserUpgradeBanner",!1);if(YUI.Env.isServer&&t.enableBrowserUpgradeBanner){var i=this.appContext.request.headers["user-agent"],s=e.BrowserSupport.isUnsupportedBrowser(i),o=e.BrowserSupport.isBot(i),u=e.BrowserSupport.isSharingBot(i);s&&!o&&!u&&this.set("showBrowserUpgradeBanner",!0)}if(!YUI.Env.isServer){var a=e.StorageHelper.getItem("hasDismissedBrowserUpgradeBanner",!0);a&&a==="true"&&this.set("showBrowserUpgradeBanner",!1)}return this.get("container").get("innerHTML")===""&&this.setContainerHTML('<div class="global-nav-content"></div>'),this.appStateParams=t,this.enableMobileNav=t.enableMobileNav||!1,n=this.appContext.getLocation(),t.modelParams&&t.modelParams.apiParams?r=t.modelParams.apiParams:r=n.href,this.searchUrl=new e.SearchUrl(r,this.appContext,t.searchType),this.appContext.flipper.isFlipped("enable-signed-out-cta-test")&&(this.signedOutTest=!0),this.appContext.flipper.isFlipped("enable-sign-up-interstitial-test")&&this.appContext.lang.toLowerCase()==="en-us"&&(this.signUpInterstitialTest=!0),this.appContext.flipper.isFlipped("enable-sign-up-rail-test")&&this.appContext.lang.toLowerCase()==="en-us"&&!this.appContext.getViewer().signedIn&&!t.isSOHP&&(this.signUpRailTest=!0),this.isSOHP=t.isSOHP,this},subviewConfig:{"search-autosuggest-field-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,isSOHP:function(){return this.isSOHP},disabled:function(){return!this.appContext.flipper.isFlipped("enable-new-autosuggest")}},"autosuggest-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,disabled:function(){return this.enableMobileNav}},"account-menu-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"notifications-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("notifications-menu")}},"browser-upgrade-banner-view":{requiredToShowOnServer:!0,requiredToShowOnClient:!1,dealbreaker:!1,disabled:function(){return!this.get("showBrowserUpgradeBanner")}},"person-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!this.appContext.flipper.isFlipped("enable-hover-account-menu")||!this.appContext.flipper.isFlipped("rebootify-group-discussions-list")}},"group-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,containerSelector:"#content",excludeSelectors:[".c-account-menu"],disabled:function(){return!this.appContext.flipper.isFlipped("enable-hover-account-menu")||!this.appContext.flipper.isFlipped("rebootify-group-discussions-list")}},"mobile-app-upsell-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,disabled:function(t){return!t.isMobile||!e.Views["mobile-app-upsell-view"].shouldShowBanner(this.appContext)}},"signup-rail-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["collapsed"],disabled:function(e){return e.isMobile||!this.signUpRailTest}}},loadState:function(){var t=this,n=this.appContext.getViewer(),r;return n.signedIn?r=this.appContext.getModel("person-models",n.nsid).then(function(e){t.set("viewer",e),t.elementStates=t.setElementStates(t.appStateParams)}):(this.elementStates=this.setElementStates(this.appStateParams),r=e.Promise.resolve()),r},buildContainer:function(){var t={},n;return this.get("viewer")&&(t=e.merge(this.get("viewer").toJSON(),{urls:e.URLHelper.generatePersonUrls(this.get("viewer"))})),n={"show-browser-upgrade-banner":this.get("showBrowserUpgradeBanner"),showNotificationsMenu:!1,viewer:t,elements:this.elementStates,enableMobileNav:this.enableMobileNav,enableNewAutosugest:this.appContext.flipper.isFlipped("enable-new-autosuggest"),enableVRLanding:this.appContext.flipper.isFlipped("enable-vr-landing"),showAutosuggest:!this.enableMobileNav,searchValue:this.searchUrl.getSearchTerm(),enableWideSearchBar:!this.appContext.getViewer().signedIn&&this.isSOHP,isEnglish:this.appContext.lang==="en-US"},n.showAutosuggest?n["autosuggest-view"]=this.subviews["autosuggest-view"].get("container"):n.enableNewAutosugest&&(n["search-autosuggest-field-view"]=this.subviews["search-autosuggest-field-view"].get("container")),this.appContext.flipper.isFlipped("notifications-menu")&&this.appContext.getViewer().signedIn&&(n["notifications-menu-view"]=this.subviews["notifications-menu-view"].get("container"),n.showNotificationsMenu=!0),this.setContainerWithTemplate("global-nav-restyle",n),this},activate:function(){var t=this,n=this.appContext.getViewer().prefs.keyboardShortcutsEnabled,r,i,s,o=this.get("container"),u=37,a=46;return i=["photo-page-ad-scrappy-view","sohp-view","products-landing-view"],r=this.appContext.flapp.get("activeView").name,n&&this.attachKeyEvent("up:83",this.focusSearch.bind(this)),t.subviews["autosuggest-view"]&&this.registerEventHandler(this.subviews["autosuggest-view"].on("open",function(e){t.subviews["account-menu-view"]&&t.subviews["account-menu-view"].closeMenu()})),t.subviews["account-menu-view"]&&this.registerEventHandler(this.subviews["account-menu-view"].on("open",function(e){t.subviews["autosuggest-view"]&&t.subviews["autosuggest-view"].close()})),this.elementStates.search_bar&&!this.appContext.flipper.isFlipped("enable-new-autosuggest")&&(s=o.one(".gn-tools form"),s&&this.registerEventHandler(s.on("submit",this.executeSearch.bind(this)))),this.appContext.flipper.isFlipped("global-nav-restyle")&&(o.one(".mobile-nav-toggle")&&this.registerEventHandler(o.one(".mobile-nav-toggle").on("click",function(n){e.rapidTracker.beacon(t.name,"mobile-nav-toggle",{action:o.one(".global-nav-restyle").hasClass("menu-open")?"close":"open"}),o.one(".global-nav-restyle").toggleClass("menu-open")}.bind(this))),o.one(".mobile-search-button")&&this.registerEventHandler(o.one(".mobile-search-button"
).on("click",function(n){e.rapidTracker.beacon(t.name,"mobile-nav-search");var r=this.get("container"),i=r.one(".global-nav-restyle"),s=r.one("#gn-search-field"),o=this.appContext.viewportData.getWidth();i.addClass("search-open"),i.hasClass("menu-open")&&i.removeClass("menu-open"),t.appContext.flipper.isFlipped("enable-new-autosuggest")?(t.fire("parentViewEvent","resize-search-field",o-a),t.fire("parentViewEvent","focus-search-field")):s.setStyles({width:o-u-a+"px"}).focus(),r.one(".flickr-logo-container").addClass("hidden")}.bind(this))),o.one(".mobile-search-close-button")&&this.registerEventHandler(o.one(".mobile-search-close-button").on("click",function(e){o.one(".global-nav-restyle").removeClass("search-open"),o.one(".flickr-logo-container").removeClass("hidden"),t.appContext.flipper.isFlipped("enable-new-autosuggest")?t.fire("parentViewEvent","clear-search-field"):o.one(".global-nav-restyle #gn-search-field").set("value","")}.bind(this))),this.registerEventHandler(e.globalEvents.subscribe("window:resize",function(n){var r=e.config.win.innerWidth<=700,i=r?this.appContext.viewportData.getWidth():0,s=r?a:0;r||(o.one(".global-nav-restyle").removeClass("search-open"),o.one(".flickr-logo-container").removeClass("hidden")),t.appContext.flipper.isFlipped("enable-new-autosuggest")?t.fire("parentViewEvent","resize-search-field",i-s):o.one(".global-nav-restyle #gn-search-field").set("value","").setStyles({width:"183px"})}.bind(this)))),this.appContext.getViewer().signedIn||(this.signedOutTest&&o.one(".gn-upload .gn-title")&&this.registerEventHandler(o.one(".gn-upload .gn-title").on("click",this.signUpAndUpload.bind(this))),i.indexOf(r)<0&&!this.isMobile&&this.signUpInterstitialTest&&this.startInterstitialTimer()),this.registerEventHandler(o.delegate("keydown",this.toggleSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(o.delegate("keydown",this.enterSubmenu.bind(this),"a[aria-haspopup=true]")),this.registerEventHandler(o.delegate("keydown",this.goToSubmenuHeading.bind(this),"ul.gn-submenu")),this.registerEventHandler(o.delegate("keydown",this.keyboardNavigation.bind(this),"ul.nav-menu")),this.registerEventHandler(o.ancestor("body").on("mouseup",this.clearKeyboardFocus.bind(this))),this.registerEventHandler(o.delegate("mouseup",this.toggleAriaExpanded.bind(this),"a[aria-haspopup=true]")),this},clearKeyboardFocus:function(e){this.get("container").all(".has-keyboard-focus").removeClass("has-keyboard-focus"),this.get("container").all(".nav-menu a[aria-expanded=true]").setAttribute("aria-expanded","false")},toggleAriaExpanded:function(e){e.target.setAttribute("aria-expanded",e.target.getAttribute("aria-expanded")==="false"?"true":"false")},enterSubmenu:function(e){if(e.keyCode===40){e.preventDefault();var t=e.target.next("ul");t&&t.hasClass("has-keyboard-focus")&&(t.one(":first-child").one(":first-child").addClass("has-keyboard-focus"),t.one(":first-child").one(":first-child").focus())}},toggleSubmenu:function(e){var t=e.keyCode;if(t===13||t===32){e.preventDefault();var n=e.target.next("ul");n&&(n.hasClass("has-keyboard-focus")?this.clearKeyboardFocus():(n.addClass("has-keyboard-focus"),e.target.setAttribute("aria-expanded","true")))}},goToSubmenuHeading:function(e,t){if(t||e.keyCode===27){t||this.clearKeyboardFocus();var n=e.target.ancestor("ul.gn-submenu").previous("a");n&&n.focus()}},keyboardNavigation:function(e){var t=e.keyCode,n=t===38||t===9&&e.shiftKey,r=t===40||t===9&&!e.shiftKey;e.target.ancestor("li").ancestor("ul").hasClass("nav-menu")?(n=n&&e.target.ancestor("li").previous("li"),r=r&&!!e.target.ancestor("li").next("li"),n?(this.clearKeyboardFocus(),this.focusOnPreviousItem(e)):r&&(!e.target.next("ul")||!e.target.next("ul").hasClass("has-keyboard-focus"))&&(this.clearKeyboardFocus(),this.focusOnNextItem(e))):n?this.focusOnPreviousItem(e):r&&this.focusOnNextItem(e)},focusOnPreviousItem:function(e){e.preventDefault();var t=e.target.ancestor("li").previous("li");t?t.one(":first-child").focus():e.target.ancestor("ul.gn-submenu")&&this.goToSubmenuHeading(e,!0)},focusOnNextItem:function(e){e.preventDefault();var t=e.target.ancestor("li").next("li");t&&t.one(":first-child").focus()},startInterstitialTimer:function(){var t=this,n,r=!1,i;n=e.StorageHelper.getItem("signUpInterstitialSeen"),n?(n=e.moment(n,"x"),i=e.moment().subtract(2,"days"),i>n&&(r=!0)):r=!0,r&&(this.signUpInterstitialTimer=setTimeout(function(){if(!e.OverlayManager.hasOverlay()&&e.config.win.innerWidth>700){var n=new e.Views.SignUpInterstitial({appContext:t.appContext});n.show(),e.StorageHelper.setItem("signUpInterstitialSeen",e.moment().format("x"))}},4e3))},destructor:function(){clearTimeout(this.signUpInterstitialTimer)},signUpAndUpload:function(t){var n=e.url("/upload/"),r=this.intlMessage({intlName:"global-nav.UPLOAD_MODAL_SIGNUP_TITLE"}),i=this.intlMessage({intlName:"global-nav.UPLOAD_MODAL_SIGNUP_MESSAGE"}),s;t.halt(),e.rapidTracker.beacon(this.name,"uploadButtonClick"),s=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-upload",signUpTitle:r,signUpMessage:i,beaconPrefix:"upload"}),s.on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("upload",{postLoginUrl:n})}),s.on("signInClick",function(t){e.SigninHelper._redirectToSignin("upload",{postLoginUrl:n})}),s.show()},focusSearch:function(e){this.appContext.flipper.isFlipped("enable-new-autosuggest")||this.get("container").one("#gn-search-field").focus()},executeSearch:function(e){var t=this.get("container").one("#gn-search-field").getDOMNode(),n;n=this.searchUrl.createNewSearch(t.value).getURL(),e.halt(),this.appContext.flapp.navigate(n)},setElementStates:function(e){var t={small_logo:!1,you_link:!1,you_menu:!1,contacts_menu:!1,groups_menu:!1,explore_menu:!1,weekly_flickr:!1,create_link:!1,create_menu:!1,upload_link:!1,upload_icon:!1,account_menu:!1,search_bar:!1,tour_link:!1,signup_link:!1,signin_link:!1,pro_upsell:!1,chronic_link:!1,editr_tour_link:!1,use_uh_eyebrow:!1,right_side_signup:!1},n=this.appContext.getViewer
(),r=e.isSOHP&&!n.signedIn;return e.isJobs?t.small_logo=!0:e.isPlayr?t.use_uh_eyebrow=!1:e.isEditr?(t.small_logo=!0,t.you_link=!0,t.chronic_link=!0,t.editr_tour_link=!0,t.account_menu=!0,t.use_uh_eyebrow=!1):r?(t.search_bar=!0,t.upload_link=!0,t.signin_link=!0,t.signup_link=!0,t.explore_menu=!1):n.signedIn?(t.you_menu=!0,t.explore_menu=!0,t.upload_link=!0,t.search_bar=!0,t.account_menu=!0):(t.tour_link=!0,t.signup_link=!0,t.explore_menu=!0,t.upload_link=!0,t.search_bar=!0,t.signin_link=!0),n.signedIn&&!r?t.create_menu=!0:!n.signedIn&&!r&&(t.create_link=!0),this.get("viewer")&&(this.appContext.flipper.isFlipped("rebootify-stats")||this.get("viewer").getValue("isPro"))&&(t.stats=!0),this.appContext.lang.toLowerCase()==="en-us"&&(t.weekly_flickr=!0),t.set_not_album=!this.appContext.flipper.isFlipped("rename-set-to-album"),this.appContext.flipper.isFlipped("enable-global-nav-upload-icon")&&(t.upload_link=!1,t.upload_icon=!0),this.signedOutTest&&(t.right_side_signup=!0),t},onSubviewEvent:function(e,t){t&&e==="mobile-app-upsell-view"&&t[0]==="removeUpsell"&&this.subviews["mobile-app-upsell-view"].destroy({remove:!0})}})},"@VERSION@",{requires:["flickr-view","hermes-template-global-nav-restyle","search-url","search-autosuggest-field-view","autosuggest-view","querystring-parse-simple","querystring-stringify-simple","notifications-menu-view","url-helper","person-menu-view","group-menu-view","browser-support","fluid-modal-view","signup-modal-view","signup-interstitial-view","signin-helper","storage-helper","mobile-app-upsell-view"],langBundles:["global-nav","common","search"]});
YUI.add("hermes-lang-global-nav",function(e,t){e.Intl.add("hermes/global-nav","en-US",{FLICKR_LOGO_ALT:["Flickr logo. If you click it, you'll go home"],YOUR_PHOTOSTREAM:["Your Photostream"],FOLLOWING:["Following"],PHOTOS_OF:["Photos of"],PHOTOS_FROM:["Photos from"],LIST:["List"],COMMUNITIES:["Communities"],GROUPS_LIST:["Groups List"],SEARCH_GROUPS:["Search Groups"],RECENT_DISCUSSIONS:["Recent Discussions"],CREATE_A_GROUP:["Create a Group"],RECENT_PHOTOS:["Recent Photos"],THE_COMMONS:["The Commons"],GETTY_COLLECTION:["Getty Collection"],GALLERIES:["Galleries"],FLICKR_GALLERIES:["Flickr Galleries"],WORLD_MAP:["World Map"],APP_GARDEN:["App Garden"],THE_WEEKLY_FLICKR:["The Weekly Flickr"],FLICKR_BLOG:["Flickr Blog"],UPLOAD:["Upload"],SIGN_IN:["Sign In"],SEARCH:["Search"],CAMERA_FINDER:["Camera Finder"],RECENT_ACTIVITY:["Recent Activity"],STATS:["Stats"],ORGANIZE:["Organize"],CREATIONS:["Creations"],FIND_FRIENDS:["Find Friends"],GROUPS:["Groups"],PEOPLE:["People"],CAMERAROLL:["Camera Roll"],CREATE:["Create"],CREATE_NEW:["New Creation"],CREATE_MY_WALLART:["My Wall Art"],CREATE_MY_PHOTOS_BOOKS:["My Photo Books"],CREATE_ORDER_HISTORY:["My Order History"],UPLOAD_MODAL_SIGNUP_TITLE:["Upload your photos securely and privately!"],UPLOAD_MODAL_SIGNUP_MESSAGE:["Join Flickr to unlock 1,000GB of free photo storage."],HOME:["Home"],LOG_IN:["Log In"]})},"@VERSION@",{requires:["intl"]});
YUI.add("empty-photo-page-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},additionalViewClasses:function(){var e=[];return!this.appContext.getViewer().signedIn&&this.appContext.flipper.isFlipped("global-nav-enabled")&&e.push("has-global-nav"),e},buildContainer:function(){return this.setContainerWithTemplate("empty-photo-page"),this}},{ATTRS:{spaceid:{value:792600606}}})},"@VERSION@",{requires:["flickr-view","hermes-template-empty-photo-page","overflow-helper","url"],optional:["global-nav-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-photo-page-lightbox",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){return e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(t!=null?t:{},t!=null?t["photo-well-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page-lightbox",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return" no-click"},3:function(e,t,n,r,i){return" is-hidden"},5:function(e,t,n,r,i){return" is-video"},7:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-url"]||(t!=null?t["prev-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-url",hash:{},data:i}):s))},9:function(e,t,n,r,i){return"#"},11:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["prev-title"]||(t!=null?t["prev-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"prev-title",hash:{},data:i}):s))},13:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-url"]||(t!=null?t["next-url"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-url",hash:{},data:i}):s))},15:function(e,t,n,r,i){var s;return e.escapeExpression((s=(s=n["next-title"]||(t!=null?t["next-title"]:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"next-title",hash:{},data:i}):s))},17:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return((s=n["if"].call(o,t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n	"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-toggle-view"]:t,{name:"outlet",hash:{},data:i}))+"\n	"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["photo-sidebar-actions-view"]:t,{name:"outlet",hash:{},data:i}))+"\n	"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["attribution-view"]:t,{name:"outlet",hash:{},data:i}))+"\n	"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["people-notes-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+((s=n["if"].call(o,t!=null?t.similaritySearchURL:t,{name:"if",hash:{},fn:e.program(20,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n"},18:function(e,t,n,r,i){return'	<div class="feedback-widget">\n		<button class="ui-button ui-button-cta ui-button-transparent"><span>Opt-out &amp; Feedback</span></button>\n	</div>\n'},20:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression;return'		<a href="'+f((o=(o=n.similaritySearchURL||(t!=null?t.similaritySearchURL:t))!=null?o:a,typeof o=="function"?o.call(u,{name:"similaritySearchURL",hash:{},data:i}):o))+'" class="similarity-search-link'+((s=n["if"].call(u,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-track="photoPageSimilaritySearchClick" title="'+f((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{intlName:"common.SEARCH_FOR_SIMILAR_PHOTOS"},data:i}))+'"><svg class="icon icon-search"><use xlink:href="#icon-search"></use></svg></a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return'<a class="navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+'"  data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-prev'+((s=n["if"].call(o,t!=null?t["prev-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["prev-url"]:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="prevPhotoButtonClick" data-action="ad"><span class="hide-text">&larr;</span></a>\n\n'+e.escapeExpression((n.outlet||t&&t.outlet||n.helperMissing).call(o,t!=null?t["photo-well-media-view"]:t,{name:"outlet",hash:{},data:i}))+'\n\n<a class="navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" title="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n<a class="navigate-target-arrow-only navigate-target navigate-next'+((s=n["if"].call(o,t!=null?t["next-is-not-clickable"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-hidden"]:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'" href="'+((s=n["if"].call(o,t!=null?t["next-url"]:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(9,i,0),data:i}))!=null?s:"")+'" data-track="nextPhotoButtonClick" data-action="ad"><span class="hide-text">&rarr;</span></a>\n\n'+((s=n.unless.call(o,t!=null?t["is-ad"]:t,{name:"unless",hash:{},fn:e.program(17,i,0),inverse:e.noop,data
:i}))!=null?s:"")},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-reboot-welcome-dialog-content",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return"	While we continue to develop the beta experience, we want your feedback. In case you need some of the missing functionality, you can easily opt-out and go back to the old experience.\n"},3:function(e,t,n,r,i){return"	Please continue providing us with feedback so we can continue to improve Flickr.\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return"Flickr is about the amazing photos you capture and the communities that you build around these photos. The goal of our photo page redesign is to provide you with a fast photo browsing experience and an easy interface to build &amp; maintain relationships.<br>\n<br>\nOver the last 4 weeks, we received a lot of feedback from the Flickr community regarding the photo page design. Based on the feedback, we are experimenting with different variations of the photo page to identify the best experience.<br>\n<br>\n"+((s=n["if"].call(t!=null?t:{},t!=null?t["opt-out-enabled"]:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"<br>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/reboot-welcome-dialog-content",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-opt-out",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'<form action="//'+f((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s===a?s.call(o,{name:"host",hash:{},data:i}):s))+'/help/optin" method="post">\n	<input type="hidden" name="photo_opt" value="0">\n	<input type="hidden" name="redirect_url" value="'+f((s=(s=n["redirect-url"]||(t!=null?t["redirect-url"]:t))!=null?s:u,typeof s===a?s.call(o,{name:"redirect-url",hash:{},data:i}):s))+'">\n	<input type="submit" class="ui-button" value="Go back to the old experience">\n</form>'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-opt-out",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-well-media",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{};return'	<div class="restricted-interstitial">\n		<div class="restricted-interstitial-message">\n			<h2>'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:i}))+"</h2>\n"+((s=n["if"].call(o,t!=null?t.isSignedIn:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(5,i,0),data:i}))!=null?s:"")+"		</div>\n	</div>\n"},2:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:i}))+"<br />"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:i}))+"</p>\n\n"+((s=n.unless.call(o,t!=null?t.isMinor:t,{name:"unless",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")},3:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return"					<p><button class='ui-button'><span>"+u((n.intlMessage||t&&t.intlMessage||o).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:i}))+"</span></button></p>\n					<p>"+u((n.intlHTMLMessage||t&&t.intlHTMLMessage||o).call(s,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:i}))+"</p>\n"},5:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return"				<p>"+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:i}))+' <a href="//'+a((s=(s=n.host||(t!=null?t.host:t))!=null?s:u,typeof s=="function"?s.call(o,{name:"host",hash:{},data:i}):s))+'/signin/" data-track="photoWellSignInClick">'+a((n.intlMessage||t&&t.intlMessage||u).call(o,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:i}))+"</a></p>\n"},7:function(e,t,n,r,i){var s,o=t!=null?t:{};return"\n"+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isVideo:t,{name:"if",hash:{},fn:e.program(10,i,0),inverse:e.program(13,i,0),data:i}))!=null?s:"")+((s=n["if"].call(o,t!=null?t.isAd:t,{name:"if",hash:{},fn:e.program(16,i,0),inverse:e.noop,data:i}))!=null?s:"")},8:function(e,t,n,r,i){var s;return'		<a class="ad-wrapper" href="'+e.escapeExpression(e.lambda((s=t!=null?t.ad:t)!=null?s.clickUrl:s,t))+'">\n'},10:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isPending:t,{name:"if",hash:{},fn:e.noop,inverse:e.program(11,i,0),data:i}))!=null?s:""},11:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'			<div class="videoplayer main-photo" style="width:'+f((s=(s=n.width||(t!=null?t.width:t))!=null?s:u,typeof s===a?s.call(o,{name:"width",hash:{},data:i}):s))+"px; height:"+f((s=(s=n.height||(t!=null?t.height:t))!=null?s:u,typeof s===a?s.call(o,{name:"height",hash:{},data:i}):s))+'px;"><video id="video_1" poster="'+f((s=(s=n.src||(t!=null?t.src:t))!=null?s:u,typeof s===a?s.call(o,{name:"src",hash:{},data:i}):s))+'" class="video-js vjs-big-play-centered inherit-size"></video></div>\n'},13:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f=e.escapeExpression,l="function";return'\n			<div class="facade-of-protection-neue '+((s=n["if"].call(u,t!=null?t["is-video"]:t,{name:"if",hash:{},fn:e.program(14,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">\n				'+f((n.outlet||t&&t.outlet||a).call(u,t!=null?t["zoom-view"]:t,{name:"outlet",hash:{},data:i}))+'\n			</div>\n\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.src||(t!=null?t.src:t))!=null?o:a,typeof o===l?o.call(u,{name:"src",hash:{},data:i}):o))+'" class="low-res-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo is-hidden" onload="registerFirstPhoto(this)" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			<noscript>\n				<img width="'+f((o=(o=n.width||(t!=null?t.width:t))!=null?o:a,typeof o===l?o.call(u,{name:"width",hash:{},data:i}):o))+'" height="'+f((o=(o=n.height||(t!=null?t.height:t))!=null?o:a,typeof o===l?o.call(u,{name:"height",hash:{},data:i}):o))+'" src="'+f((o=(o=n.highResSrc||(t!=null?t.highResSrc:t))!=null?o:a,typeof o===l?o.call(u,{name:"highResSrc",hash:{},data:i}):o))+'" class="main-photo" alt="'+f((o=(o=n.imgAltText||(t!=null?t.imgAltText:t))!=null?o:a,typeof o===l?o.call(u,{name:"imgAltText",hash:{},data:i}):o))+'">\n			</noscript>\n'},14:function(e,t,n,r,i){return"is-video"},16:function(e,t,n,r,i){var s;return'			<span class="ad-info">'+e.escapeExpression((n.intlHTMLMessage||t&&t.intlHTMLMessage||n.helperMissing).call(t!=null?t:{},{name:"intlHTMLMessage",hash:{brand:(s=t!=null?t.ad:t)!=null?s.brand:s,intlName:"photo-page-scrappy.FIND_OUT_MORE_AD"},data:i}))+"</span>\n		</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.needsInterstitial:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=
e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-media",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-well-media-view",function(e,t){var n=require("lib/flog")(t),r=500,i=500,s=100,o;o={photo:{render:function(){var t=this,n=this.get("photo"),r,i,o=new Date,u="";return t.preloadImage&&(t.preloadImage.onload=null),r=this.getPhotoForDisplay(),i=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]}),n.getValue("owner")&&(n.getValue("title").trim()===""?u=this.intlMessage({intlName:"common.UNTITLED"}):u=n.getValue("title"),u+=" | "+this.intlMessage({intlName:"common.BY_USER",user:n.getValue("owner").getValue("username")})),this.setContainerWithTemplate("photo-well-media",{width:r.width,height:r.height,src:i.url,highResSrc:r.url,imgAltText:u,needsInterstitial:n.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:n.getValue("isVideo"),isMinor:this.appContext.getViewer().isMinor,isAd:this.isAd}),this.fire("subviewViewEvent",r),YUI.Env.isServer?(this.serverWidth=r.width,this.serverHeight=r.height):n.getValue("needsInterstitial")||(t.preloadImage=new Image,t.preloadImage.onload=function(){if(this.onloadFired)return;if(!t.isActiveAndInDOM())return;this.onloadFired=!0;var n,i="photoPageShowedSize",u="\u00f8";try{n=/(?:_([a-z]))?\.jpg/.exec(r.url),n&&n[1]&&(u=n[1])}catch(a){}finally{i+=String(u).toUpperCase()}e.rapidTracker.beacon(this.name,i);var f=t.get("container").one(".low-res-photo"),l=t.get("container").one(".main-photo"),c=new Date-o,h;c<s?(l.removeClass("is-hidden").show(),f.hide()):(l.setStyles({position:"absolute",left:0,top:0,opacity:0}),l.removeClass("is-hidden"),h=function(){l.removeAttribute("style"),f.hide()},e.UA.ie?h():e.use("transition",function(e){l.transition({duration:.25,opacity:1},h)}))},t.preloadImage.src=r.url,t.preloadImage.complete&&t.preloadImage.onload()),this}},video:{render:function(){var e=this.get("photo"),t=this.getPhotoForDisplay({excludeSizes:[]});return!this.player||e.getValue("isVideoPending")?(this.setContainerWithTemplate("photo-well-media",{width:t.width,height:t.height,src:t.url,needsInterstitial:e.getValue("needsInterstitial"),isVideo:e.getValue("isVideo"),isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this.fire("subviewViewEvent",t),this):(e.getValue("isVideoPending")||(this.player.dimension?(this.player.dimension("width",t.width),this.player.dimension("height",t.height)):this.player.resize(t.width,t.height)),this)}},ad:{render:function(){return this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disableIfSmall:!0}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,this.ad=e.ad,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then(function(n){t.set("photo",n);if(n.getValue("isVideo"))return new e.Promise(function(t,n){e.use("flickr-video-player",function(){t()})})})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?o.ad.render.call(this):o[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this),this},handleInterstitialDismissButtonClick:function(t){var r=this,i=this.get("personPreferences"),s=this.get("photo"),o=s.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),i.setValue("safeSearch",o),i.registry.remoteUpdate(r.appContext.auth.user.nsid).then(function(e){var t=s.registry.attributeSearch({needsInterstitial:!0});t.forEach(function(e){s.registry.getValue(e,"safetyLevel")<=i.getValue("safeSearch")&&s.registry.setValue(e,"needsInterstitial",!1)}),r.buildContainer()},function(e){n.error({err:e}),r.onError(r.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},activate:function(){var t=this,n=this.getPhotoForDisplay(),r=this.get("container").one(".main-photo"),i,s;return this.get("photo").getValue("isVideo")&&!this.get("photo").getValue("isVideoPending")&&(t.player=new e.FlickrVideoPlayer({container:t.get("container").one(".videoplayer"),model:t.get("photo"),appContext:t.appContext,videoNode:e.one("#video_1")?e.one("#video_1")._node:null,autoplay:!0,loop:!0,controlBar:{fullscreenToggle:!1}}),t.player.init().then(function(){}),t.on("destroy",function(){t.player&&(t.player.destroy(),t.player=null)})),this.get("photo").getValue("needsInterstitial")||(e.use("global-events",function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()}))}),this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),!this.isAd&&(!t.get("clientRendered")||n.width!==Number(r.getAttribute("width"))||n.height!==Number(r.getAttribute("height")))&&t.buildContainer()),this.registerEventHandler(e.on("flickr:display-note-box",function(n){i=e.Node.create('<div class="note-box"></div>'),s=t.get("container").one(".main-photo").getXY(),t.get("container").append(i),i.setStyles({top:n.noteBoxTop+t.get("container").one(".main-photo").getDOMNode().offsetTop,left:n.noteBoxLeft,width:n.noteBoxWidth,height:n.noteBoxHeight})})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},onError:function(t){var n=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,classList:"scrappy-dialog"});n.show()},getPhotoForDisplay:function(e){var t=this.getCanvasSize(),n=this.getPixelRatio(),r=this.get
("photo").getSizeToFit(t,e),i,s;return i=Math.min(t.height/n,r.height),s=Math.min(t.width/n,r.width/r.height*i),i=Math.min(i,r.height/r.width*s),{width:Math.round(s),height:Math.round(i),url:r.url,pixelRatio:r.width/s}},getCanvasSize:function(){var e,t=this.getPixelRatio(),n;return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(n=this.get("container").ancestor(),n&&(e=n.get("region"),e.width>0&&e.height>0&&(this.set("canvasSizeIsDirty",!1),this.set("cachedCanvasSize",e),this.appContext.setCookie({remove:!0,cookieName:"photoPW",path:"/photos/",cookieValue:e.width}),this.appContext.setCookie({remove:!0,cookieName:"photoPH",path:"/photos/",cookieValue:e.height}),this.appContext.setCookie({remove:!0,cookieName:"density",path:"/photos/",cookieValue:t})))):e=this.get("cachedCanvasSize"),e||(e={top:0,left:0,bottom:i,right:r,width:parseInt(this.appContext.getCookie("photoPW"),10)||r,height:parseInt(this.appContext.getCookie("photoPH"),10)||i}),e.height*=t,e.width*=t,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media","moment","zoom-view"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-lang-attribution",function(e,t){e.Intl.add("hermes/attribution","en-US",{FOLLOW:["Follow"],FOLLOWING:["Following"],ERROR_SETTING_FRIEND:["There was a problem setting your friend relationship"],ERROR_SETTING_FAMILY:["There was a ",{type:"number",valueName:"POPULATION",format:"integer"}," problem setting your family relationship"],FRIEND:["Friend"],FAMILY:["Family"],UNFOLLOW:["Unfollow"],GO_TO_PHOTOSTREAM:["Go to ","${name}","'s photostream"],BY_USER:["By: ","${user}"]})},"@VERSION@",{requires:["intl"]});
YUI.add("hermes-template-head-meta",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){return'name="'},3:function(e,t,n,r,i){return'property="'},5:function(e,t,n,r,i){return'description="'+e.escapeExpression(e.lambda(t,t))+'"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u,a=t!=null?t:{},f=n.helperMissing,l="function",c=e.escapeExpression,h="<meta "+((s=n["if"].call(a,t!=null?t.isName:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+c((o=(o=n.metaName||(t!=null?t.metaName:t))!=null?o:f,typeof o===l?o.call(a,{name:"metaName",hash:{},data:i}):o))+'" content="'+c((n.renderMetaInfo||t&&t.renderMetaInfo||f).call(a,t!=null?t.metaValue:t,{name:"renderMetaInfo",hash:{},data:i}))+'" ';return s=(o=(o=n.metaDescription||(t!=null?t.metaDescription:t))!=null?o:f,u={name:"metaDescription",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i},typeof o===l?o.call(a,u):o),n.metaDescription||(s=n.blockHelperMissing.call(t,s,u)),s!=null&&(h+=s),h+' data-dynamic="true">\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-meta",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-head-link",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return'id="'+e.escapeExpression((s=(s=n.id||(t!=null?t.id:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"id",hash:{},data:i}):s))+'"'},3:function(e,t,n,r,i){var s;return'rev="'+e.escapeExpression((s=(s=n.rev||(t!=null?t.rev:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"rev",hash:{},data:i}):s))+'"'},5:function(e,t,n,r,i){var s;return'rel="'+e.escapeExpression((s=(s=n.rel||(t!=null?t.rel:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"rel",hash:{},data:i}):s))+'"'},7:function(e,t,n,r,i){var s;return'type="'+e.escapeExpression((s=(s=n.type||(t!=null?t.type:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"type",hash:{},data:i}):s))+'"'},9:function(e,t,n,r,i){var s;return'media="'+e.escapeExpression((s=(s=n.media||(t!=null?t.media:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"media",hash:{},data:i}):s))+'"'},11:function(e,t,n,r,i){var s;return'href="'+e.escapeExpression((s=(s=n.href||(t!=null?t.href:t))!=null?s:n.helperMissing,typeof s=="function"?s.call(t!=null?t:{},{name:"href",hash:{},data:i}):s))+'"'},13:function(e,t,n,r,i){return'data-dynamic-added-by="'+e.escapeExpression((n.obfuscateInternals||t&&t.obfuscateInternals||n.helperMissing).call(t!=null?t:{},t!=null?t.addedBy:t,{name:"obfuscateInternals",hash:{},data:i}))+'"'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{};return"<link "+((s=n["if"].call(o,t!=null?t.id:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.rev:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.rel:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.type:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.media:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.href:t,{name:"if",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))!=null?s:"")+" "+((s=n["if"].call(o,t!=null?t.addedBy:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i}))!=null?s:"")+' data-dynamic="true" />'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-link",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-head-breadcrumb",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'<script type="application/ld+json">\n	{\n		"@context": "http://schema.org",\n		"@type": "BreadcrumbList",\n		"itemListElement": [\n			{\n				"@type": "ListItem",\n				"position": 1,\n				"item": {\n					"@id": "https://www.flickr.com/photos/'+f((s=(s=n.pathAliasOrNsid||(t!=null?t.pathAliasOrNsid:t))!=null?s:u,typeof s===a?s.call(o,{name:"pathAliasOrNsid",hash:{},data:i}):s))+'",\n					"name": "'+f((s=(s=n.displayName||(t!=null?t.displayName:t))!=null?s:u,typeof s===a?s.call(o,{name:"displayName",hash:{},data:i}):s))+'",\n					"image": "https://'+f((s=(s=n.avatarUrl||(t!=null?t.avatarUrl:t))!=null?s:u,typeof s===a?s.call(o,{name:"avatarUrl",hash:{},data:i}):s))+'"\n				}\n			}, {\n				"@type": "ListItem",\n				"position": 2,\n				"item": {\n					"@id": "https://www.flickr.com/photos/'+f((s=(s=n.pathAliasOrNsid||(t!=null?t.pathAliasOrNsid:t))!=null?s:u,typeof s===a?s.call(o,{name:"pathAliasOrNsid",hash:{},data:i}):s))+"/"+f((s=(s=n.photoId||(t!=null?t.photoId:t))!=null?s:u,typeof s===a?s.call(o,{name:"photoId",hash:{},data:i}):s))+'",\n					"name": "'+f((s=(s=n.title||(t!=null?t.title:t))!=null?s:u,typeof s===a?s.call(o,{name:"title",hash:{},data:i}):s))+'",\n					"image": "https://'+f((s=(s=n.photoPreview||(t!=null?t.photoPreview:t))!=null?s:u,typeof s===a?s.call(o,{name:"photoPreview",hash:{},data:i}):s))+'"\n				}\n			}\n		]\n	}\n</script>\n'},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/head-breadcrumb",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-head-meta-view",function(e){var t=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},subviewConfig:{},buildContainer:function(){return this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-head-meta-models",t._params.photoId),t.appContext.getModel("photo-models",t._params.photoId),t.appContext.getModel("photo-privacy-models",t._params.photoId)]).then(function(e){t.set("photo-meta",e[0]),t.set("photo",e[1]),t.set("photo-privacy",e[2])})},buildHeadContainer:function(){var t=this.get("photo-meta"),n=this.get("photo"),r=n.getValue("owner"),i=r.getValue("buddyicon"),s=n.getValue("sizes"),o=this.get("photo-privacy"),u=e.url(),a=t.getFieldsForDisplay(),f="",l=this,c=[{id:"canonicalurl",rel:"canonical",href:u+n.getValue("url")},{rel:"alternative",type:"application/json+oembed",href:u+"/services/oembed?url="+encodeURI(u+n.getValue("url"))+"&format=json",title:n.getValue("title")},{rel:"alternative",type:"text/xml+oembed",href:u+"/services/oembed?url="+encodeURI(u+n.getValue("url"))+"&format=xml",title:n.getValue("title")},{rel:"alternative",media:"only screen and (max-width: 640px)",href:"https://m.flickr.com"+encodeURI(n.getValue("url")+"/")}];a["al:ios:url"]||(a["al:ios:url"]="flickr://flickr.com"+n.getValue("url")),f+=this.templates("head-meta")({isName:!0,metaName:"description",metaValue:n.getValue("description")||""})+"\n";var h="noarchive";return o.getValue("isPublic")||(h+=", noindex"),f+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:h}),f+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:h}),Object.keys(a).forEach(function(e){typeof a[e]=="object"&&e==="pinterest"?f+=l.templates("head-meta")({metaName:e,noPin:!0,metaValue:a[e].nopin,metaDescription:a[e].reason,isName:!0})+"\n":e==="og:description"?f+=l.templates("head-meta")({metaName:e,metaValue:a[e]})+"\n":e==="title"?f+=l.templates("head-meta")({isName:!0,metaName:"title",metaValue:a[e]})+"\n":e==="keywords"?f+=l.templates("head-meta")({isName:!0,metaName:e,metaValue:a[e]})+"\n":e==="noindexfollow"?a[e]&&(a[e]>0||a[e]!=="")&&(f+=l.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noindex,follow"})+"\n",f+=l.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noindex,follow"})+"\n"):f+=l.templates("head-meta")({metaName:e,metaValue:a[e]})+"\n"}),c.forEach(function(e){e.addedBy=l.name,f+=l.templates("head-link")(e)+"\n"}),f+=l.templates("head-breadcrumb")({pathAliasOrNsid:r.getValue("pathAlias")||r.getValue("id"),displayName:r.getValue("displayname"),avatarUrl:i.default,photoId:n.getValue("id"),title:n.getValue("title")||"Untitled",photoPreview:s.s.url}),this.set("headContainer",f),YUI.Env.isServer||this.updateHead(),this}});return e.mix(t.prototype,e.Seo),t},"@VERSION@",{requires:["flickr-view","hermes-template-head-meta","hermes-template-head-link","hermes-template-head-breadcrumb"],optional:["photo-head-meta-models","photo-route","url","seo"],langBundles:["meta","common","attribution","share-modal"]});
YUI.add("hermes-lang-meta",function(e,t){e.Intl.add("hermes/meta","en-US",{PHOTOSTREAM:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"photo on Flickr!",other:"${#} photos on Flickr!"}}],PHOTOSTREAM_NO_PHOTOS:["Explore ","${username}","'s photos on Flickr!"],ALBUMS_LIST:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"album on Flickr!",other:"${#} albums on Flickr!"}}],ALBUMS_LIST_NO_ALBUMS:["Explore ","${username}","'s albums on Flickr!"],FAVORITES:["Explore ","${username}","'s ",{type:"plural",valueName:"photoCount",options:{one:"favorites on Flickr!",other:"${#} favorites on Flickr!"}}],FAVORITES_NO_PHOTOS:["Explore ","${username}","'s favorites on Flickr!"],META_DESCRIPTION_BY_USER_ON_FLICKR:["By ","${username}"," on Flickr"],PHOTOSTREAM_ATOM_TITLE:["Flickr: ","${username}","'s Photostream Atom feed"],FAVORITES_ATOM_TITLE:["Flickr: ","${username}","'s Favorites Atom feed"],GROUP_POOL_ATOM_TITLE:["Flickr: ","${groupName}","'s Photos Atom feed"],GROUP_DISCUSSIONS_ATOM_TITLE:["Flickr: ","${groupName}","'s Discussions Atom feed"]})},"@VERSION@",{requires:["intl"]});
YUI.add("photo-page-lightbox-scrappy-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var n=this;return this.backToURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.photoId=t.photoId,this.isOwner=t.isOwner,this.context=e.clone(t.context,!0),this.appContext.experiments.fullscreen.enableFullscreen(),t.realFullscreen=!0,t.isOwner=this.isOwner,this.appContext.getViewer().signedIn&&(t.signinPendingQueue=e.SigninHelper.checkPendingQueue(this.appContext)),this.appContext.getModel("photo-models",this.photoId).then(function(t){t.on("valuesChanged",function(t){t.title&&e.one("head title").set("text",n.intlMessage({intlName:"photo-page-scrappy.PAGE_TITLE",title:t.title.newVal}))})}),this},subviewConfig:{"photo-well-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,additionalViewClasses:["scrappy-photo-page-enabled","is-real-fullscreen","enable-zoom"],dealbreaker:!0},"photo-head-meta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},buildContainer:function(){var t=this.subviews["photo-well-view"].get("container");return this.setContainerWithTemplate("photo-page-lightbox",{"photo-well-view":t}),e.fletrics.increment("test.photo.page.requests"),this},activate:function(){return this},closeDialog:function(t){e.config.win.location.href=this.backToURL},getTrackingSegments:function(){return{context:this.context.modelName.replace("-models",""),vwrOwner:this.isOwner?1:0}},destructor:function(){clearTimeout(this.scrollTimeout)}},{ATTRS:{spaceid:{value:792600552}}}),e.Base.plug(e.Views[this.name],e.Plugin.FlickrView.TTFPRecorderPlugin,{selector:".main-photo"})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-page-lightbox","fletrics","ttfp-recorder-plugin","signin-helper","url"],optional:["photo-well-view","photo-head-meta-view"],langBundles:["common","photo-page-scrappy"]});
YUI.add("photo-well-scrappy-view",function(e,t){var n=require("lib/flog")(t),r=1,i=5;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.contextData=e.clone(t.context,!0),this.entryURL=t.backToURL,this.entryTypeIntlKey=t.entryTypeIntlKey,this.isAd=!!t.ad,this.hideBackToLink=t.hideBackToLink||!1,this.publisherUrl=t.publisherUrl,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.numberOfPositionsToPreFetch=t.numberOfPositionsToPreFetch,this.numberOfPositionsToRefetchAt=t.numberOfPositionsToRefetchAt,this},additionalViewClasses:["centered-content"],subviewConfig:{"photo-well-media-scrappy-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-notes-scrappy-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(e){return!this.appContext.flipper.isFlipped("enable-scrappy-notes")||e.ad}},"photo-engagement-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"context-slider-scrappy-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"photo-sidebar-toggle-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,neverShowOnServer:!0,disabled:function(){return this.appContext.flipper.isFlipped("enable-similarity-search-from-photo-page")}},"attribution-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen","photo-attribution"]},"people-notes-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:!0}},loadState:function(){var t=this,r=[];return r.push(this.appContext.getModel("photo-models",this.photoId).then(function(e){if(!e)throw new Error("[photo-well-view] Invalid photoModel returned from getModel");t.set("photo",e)})),this.contextData&&this.contextData.modelName&&this.contextData.params&&r.push(this.appContext.getModelRegistry(this.contextData.modelName).then(function(e){var r;if(e){r=e.attributeSearch(t.contextData.params);if(r&&r.length&&e.exists(r[0]))return t.appContext.getModel(t.contextData.modelName,r[0]).then(function(e){e&&t.set("contextModel",e)},function(e){return n.error("photo not found in context. Loading photostream instead.",{err:e}),t.loadPhotostreamContext()})}}).catch(function(){return"whatever"})),e.Promise.all(r)},buildContainer:function(){var e=this,t="",n,r=0,i,s,o=".navigate-prev",u=".navigate-next",a,f,l,c,h,p,d;return this.appContext.experiments.fullscreen.getMode()?this.subviews["attribution-view"]&&(YUI.Env.isServer||this.subviews["attribution-view"].get("container").removeClass("is-always-hidden"),this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&this.subviews["attribution-view"].get("container").addClass("is-hidden"),t=this.subviews["attribution-view"].get("container")):this.subviews["attribution-view"]&&(this.subviews["attribution-view"].get("container").addClass("is-always-hidden"),t=this.subviews["attribution-view"].get("container")),this.get("contextModel")&&this.get("contextModel").getValue("photoContextList")&&(n=this.get("contextModel").getValue("photoContextList").getList(),n.length>2&&n.some(function(t){return r++,t.getValue("id")===e.photoId})&&(i=n.slice(r-2,r-1),s=n.slice(r,r+1),i&&i.length>0&&(a=e.setupNavLink(i[0],o,"previous"),l=e.setupNavTitle(i[0])),s&&s.length>0&&(f=e.setupNavLink(s[0],u,"next"),c=e.setupNavTitle(s[0])))),this.appContext.flipper.isFlipped("enable-similarity-search-from-photo-page")&&(d=this.get("photo").getValue("similaritySearchURL")),h=this.getPhotoWellHeight(),p=h-70,this.setContainerWithTemplate("photo-well-scrappy",{"photo-well-media-view":this.subviews["photo-well-media-scrappy-view"]?this.subviews["photo-well-media-scrappy-view"].get("container"):"","context-slider-view":this.subviews["context-slider-scrappy-view"]?this.subviews["context-slider-scrappy-view"].get("container"):"","is-hidden":!a&&!f,"prev-is-not-clickable":!a,"next-is-not-clickable":!f,"prev-url":a,"next-url":f,"prev-title":l,"next-title":c,"is-ad":this.isAd,"attribution-view":t,height:h,navHeight:p,entryURL:this.entryURL,backToLabel:this.intlMessage({intlName:"photo-page-scrappy."+this.entryTypeIntlKey}),enableZoom:!0,hideBackToLink:this.hideBackToLink,similaritySearchURL:d}),YUI.Env.isServer||(this.subviews["photo-well-media-scrappy-view"]&&this.subviews["photo-well-media-scrappy-view"].fire("parentViewEvent","photoWellResized"),this.subviews["photo-notes-scrappy-view"]&&this.subviews["photo-notes-scrappy-view"].fire("parentViewEvent","photoWellResized")),YUI.Env.isServer&&(this.serverWidth=this.subviews["photo-well-media-scrappy-view"].serverWidth,this.serverHeight=this.subviews["photo-well-media-scrappy-view"].serverHeight),this},buildHeadContainer:function(){var e=this.templates("photo-page-right-size-express")({photoWidth:this.get("photo").getLargestSize().width,photoHeight:this.get("photo").getLargestSize().height});return this.set("headContainer",e),this},setLinkAsAdFriendly:function(e){var t=e.currentTarget;t.hasClass("navigate-next")?this.appContext.adManager.setAdCouldBeShown(!0,"next",t.getAttribute("href")):this.appContext.adManager.setAdCouldBeShown(!0,"previous",t.getAttribute("href"))},animateNavigation:function(){var t=e.all(".navigate-target"),n=this.get("container"),r=n.one(".photo-sidebar-toggle-view"),i=n.one(".attribution-view"),s=1500,o=250,u=!1,a=!1,f=!0,l=this;s=(s-500)/2,u=!0,a=this.appContext.experiments.fullscreen.getMode(),this.registerEventHandler(this.get("container").on("mousemove",e.betterThrottle(function(e){t&&f&&t.removeClass("is-hidden"),u&&f&&(r&&r.removeClass("is-hidden"),i&&i.removeClass("is-hidden")),clearTimeout(l.movingTimeout),clearTimeout(l.initialTimeout),f=!0,l.movingTimeout=setTimeout(function(){u&&i&&i.addClass("is-hidden")},s*2)},o))),this.contextData.modelName!=="photoList-models"&&this.contextData.modelName!=="explore-models"&&(f=!1),l.initialTimeout=setTimeout(function(){f=!0,u&&f&&i&&i.addClass("is-hidden")},s*2)},activate:function(){var t=
this,s=this.contextData,o=0,u,a,f,l,c,h=".navigate-prev",p=".navigate-next",d=this.appContext.getViewer().prefs.keyboardShortcutsEnabled;return YUI.Env.isServer||(a=e.getLocation(),f=a.protocol,l=a.hostname,t.appContext.getModel(s.modelName,s.params).then(function(e){t.set("contextModel",e)},function(n){if(!n.getModelFailure&&n.code!==1||s.modelName==="photostream-models")throw e.one(h).hide(),e.one(p).hide(),n;return t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.appContext.getModel("photostream-models",t.contextData.params).then(function(e){t.set("contextModel",e)})}).then(function(){var n=t.get("contextModel").getValue("photoContextList"),r=n.getList(),i,u,a,d;return r.length>2&&r.some(function(e){return o++,e.getValue("id")===t.photoId})&&(i=r.slice(o-2,o-1),u=r.slice(o,o+1),i&&i.length>0&&(a=t.setupNavLink(i[0],h,"previous"),a&&(t.updateNavLinks(t.get("container").one(h),f,l,a),t.get("container").one(h).removeClass("no-click"))),u&&u.length>0&&(d=t.setupNavLink(u[0],p,"next"),d&&(t.updateNavLinks(t.get("container").one(p),f,l,d),t.get("container").one(p).removeClass("no-click")))),c=e.merge(s.params,{photoId:t.photoId,numNext:t.numberOfPositionsToPreFetch,numPrev:t.numberOfPositionsToPreFetch,refetchAt:t.numberOfPositionsToRefetchAt}),n.getContext(c)}).then(function(s){function o(o,u){var a=t.get("container").one(o),c,h,p,d,v,m,g=s&&s[u]&&s[u].length,y;if(!a)return;if(!g){a.remove();return}a.removeClass("no-click"),c=t.setupNavLink(s[u][0],o,u);if(t.isAd)p=t.appContext.adManager.origin,u===p.arrow?(a.setAttribute("href",p.url),a.removeClass("is-hidden")):(a.setAttribute("href",c),a.removeClass("is-hidden"));else{t.updateNavLinks(a,f,l,c),h=t.subviews["photo-well-media-scrappy-view"].getCanvasSize();for(m=0;m<i;m++){if(!s[u][m])break;d=s[u][m].getSizeToFit(h,{includeSizes:["sq","q","t","s","n"]}),d&&d.url&&(v=new Image,v.src=d.url)}for(m=0;m<r;m++){if(!s[u][m])break;d=s[u][m].getSizeToFit(h),d&&d.url&&(v=new Image,y=e.guid(),e.LH&&e.LH.mark("mark_time_to_load_photo_only_start"+y),v.onload=function(){if(v.onloadFired)return;v.onloadFired=!0;try{e.LH.mark("mark_time_to_load_photo_only"+y);var t=e.LH.measure("time_to_load_photo_only",{startMark:"mark_time_to_load_photo_only_start"+y,endMark:"mark_time_to_load_photo_only"+y});!YUI.Env.isServer&&e.config.win.beaconError&&window.beaconError("time_to_load_photo_only",window.location.href,{duration:t.duration})}catch(r){n.warn("time to load photo: Missing start mark",{err:r})}}),v.src=d.url,v.complete&&(v.onloadFired=!0)}}}t.appContext.adManager.updateContext({prev:s.previous[0],current:t.get("photo"),next:s.next[0],type:t.contextData.modelName,entryURL:t.entryURL}),o(p,"next"),o(h,"previous"),t.animateNavigation(),t.isAd&&t.appContext.adManager.markAdAsSeen()},function(e){if(e.notInContext||e.code===99)return t.get("contextModel").setValue("photoContextList",[]),t.contextData.modelName="photostream-models",t.contextData.params.id=t.get("photo").getValue("owner").getValue("nsid"),t.activate();throw e}).then(null,function(e){n.warn("There was a problem initializing the next/previous controls.",{err:e})}),d&&this.attachKeyEvent("down:37,75,39,74",t.handlePrevNextKeys.bind(t)),this.get("photo").getValue("isOwner")||this.appContext.getViewCounter().queue(this.get("photo").getValue("id"),this.publisherUrl||this.appContext.getReferrer())),u={":ad":t.setLinkAsAdFriendly},d&&!this.hideBackToLink&&this.attachKeyEvent("down:66",function(n){n.preventDefault(),e.rapidTracker.beacon(t.name,"backToContextKeyPress"),t.appContext.flapp.hasRoute(t.entryURL)?t.appContext.flapp.navigate(t.entryURL):e.config.win.location.href=t.entryURL}),t.registerEventHandler(e.on("resize",e.betterThrottle(function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()},16))),t.buildContainer(),t.attachEvents(u),this},getPhotoWellHeight:function(){var e=500,t=this.appContext.viewportData.getWidth(),n=this.appContext.viewportData.getHeight()-50,r=1,i=2.3,s=2.75,o=120,u=t/r+o,a=t/i+o,f=t/s,l;return n>u?l=t/r:n>a?l=n-o:n>f?l=n-o+o*(n-a)/(f-a):l=n,Math.max(e,Math.round(l))},setupNavLink:function(t,r,i){var s=this.get("container").one(r),o,u;if(!t){s.remove();return}o=t,u=e.URLHelper.getPhotoPage({photoId:o.getValue("id"),pathAlias:o.getValue("owner").getValue("pathAlias"),contextSuffix:this.get("contextModel").getValue("urlSuffix")});if(!u||u==="#"){n.warn("Invalid next/prev URL",{url:u}),s.remove();return}return u},setupNavTitle:function(e){var t;return e.getValue("owner")&&(e.getValue("title").trim()===""?t=this.intlMessage({intlName:"common.UNTITLED"}):t=e.getValue("title"),t+=" | "+this.intlMessage({intlName:"common.BY_USER",user:e.getValue("owner").getValue("username")})),t},updateNavLinks:function(e,t,n,r){e.setAttribute("href",t+"//"+n+r),e.removeClass("is-hidden")},destructor:function(){clearTimeout(this.movingTimeout),clearTimeout(this.initialTimeout),this.movingTimeout=null,this.initialTimeout=null},handlePrevNextKeys:function(t){var r=this,i,s,o,u=50;if(t.button===37||t.button===75)s=".navigate-prev",o="previous",e.rapidTracker.beacon(this.name,"prevPhotoKeyPress");else if(t.button===39||t.button===74)s=".navigate-next",o="next",e.rapidTracker.beacon(this.name,"nextPhotoKeyPress");s&&r.get("container").one(s)&&(t.preventDefault(),i=r.get("container").one(s).getAttribute("href"),i&&i!=="#"&&(r.keyboardNavigation&&r.keyboardNavigation.url&&i===r.keyboardNavigation.url&&(new Date).getTime()-r.keyboardNavigation.time<u?n.log("Ignoring duplicate keyboard navigation",{url:i}):(r.keyboardNavigation={url:i,time:(new Date).getTime()},this.appContext.adManager.setAdCouldBeShown(!0,o,i),r.appContext.flapp.navigate(i))))},handleContextMenu:function(e){e.preventDefault(),this.fire("parentViewEvent","rightClickPhoto")},onSubviewEvent:function(e,t){t&&t[0]==="photoWellResized"&&this.fire("parentViewEvent","photoWellResized")}})},"@VERSION@",{requires:["yui-throttle","flickr-view","hermes-template-photo-well-scrappy"
,"url-helper","better-throttle","hermes-template-photo-page-right-size-express"],optional:["photo-well-media-scrappy-view","context-slider-scrappy-view","photo-engagement-view","photo-models","photo-route"],langBundles:["common","photo-page-scrappy"]});
YUI.add("hermes-template-sub-photo",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return'<div class="sub-photo-container centered-content">\n    '+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-left-view"]:t,{name:"outlet",hash:{},data:i}))+"\n    "+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-right-view"]:t,{name:"outlet",hash:{},data:i}))+'\n    <div style="clear: both;"></div>\n    '+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-keyboard-shortcuts-view"]:t,{name:"outlet",hash:{},data:i}))+"\n</div>"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-sub-photo-left",function(e,t){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s=t!=null?t:{},o=n.helperMissing,u=e.escapeExpression;return u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["attribution-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-title-desc-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-fave-view"]:t,{name:"outlet",hash:{},data:i}))+"\n"+u((n.outlet||t&&t.outlet||o).call(s,t!=null?t["sub-photo-comments-view"]:t,{name:"outlet",hash:{},data:i}))},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/sub-photo-left",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-attribution",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'	<a class="avatar person medium no-menu" data-person-nsid="'+f((s=(s=n.nsid||(t!=null?t.nsid:t))!=null?s:u,typeof s===a?s.call(o,{name:"nsid",hash:{},data:i}):s))+'" style="background-image: url('+f((s=(s=n.buddyicon||(t!=null?t.buddyicon:t))!=null?s:u,typeof s===a?s.call(o,{name:"buddyicon",hash:{},data:i}):s))+');" href="/photos/'+f((s=(s=n.pathAlias||(t!=null?t.pathAlias:t))!=null?s:u,typeof s===a?s.call(o,{name:"pathAlias",hash:{},data:i}):s))+'/"></a>\n'},3:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a="function",f=e.escapeExpression;return'	<div class="avatar person medium" data-person-nsid="'+f((s=(s=n.nsid||(t!=null?t.nsid:t))!=null?s:u,typeof s===a?s.call(o,{name:"nsid",hash:{},data:i}):s))+'" style="background-image: url('+f((s=(s=n.buddyicon||(t!=null?t.buddyicon:t))!=null?s:u,typeof s===a?s.call(o,{name:"buddyicon",hash:{},data:i}):s))+');" tabindex="0"></div>\n'},5:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isPro:t,{name:"if",hash:{},fn:e.program(6,i,0),inverse:e.noop,data:i}))!=null?s:""},6:function(e,t,n,r,i){return'		<a href="/account/upgrade/pro" class="pro-badge-inline">PRO</a>\n'},8:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isPro:t,{name:"if",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))!=null?s:""},9:function(e,t,n,r,i){return'			<a href="/account/upgrade/pro" class="pro-badge-inline">PRO</a>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o,u=t!=null?t:{},a=n.helperMissing,f="function",l=e.escapeExpression;return((s=n["if"].call(u,t!=null?t.noMenu:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"\n"+((s=n.unless.call(u,t!=null?t.isAlbumView:t,{name:"unless",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))!=null?s:"")+'\n<div class="attribution-info">\n\n	<a href="/photos/'+l((o=(o=n.pathAlias||(t!=null?t.pathAlias:t))!=null?o:a,typeof o===f?o.call(u,{name:"pathAlias",hash:{},data:i}):o))+'/" class="owner-name truncate" title="'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{name:t!=null?t.displayname:t,intlName:"attribution.GO_TO_PHOTOSTREAM"},data:i}))+'" data-track="attributionNameClick">'+l((o=(o=n.displayname||(t!=null?t.displayname:t))!=null?o:a,typeof o===f?o.call(u,{name:"displayname",hash:{},data:i}):o))+'</a>\n	<a href="/photos/'+l((o=(o=n.pathAlias||(t!=null?t.pathAlias:t))!=null?o:a,typeof o===f?o.call(u,{name:"pathAlias",hash:{},data:i}):o))+'/" class="owner-name-with-by truncate" title="'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{name:t!=null?t.displayname:t,intlName:"attribution.GO_TO_PHOTOSTREAM"},data:i}))+'" data-track="attributionNameClick">'+l((n.intlMessage||t&&t.intlMessage||a).call(u,{name:"intlMessage",hash:{user:t!=null?t.displayname:t,intlName:"attribution.BY_USER"},data:i}))+"</a>\n\n	"+l((n.outlet||t&&t.outlet||a).call(u,t!=null?t["follow-view"]:t,{name:"outlet",hash:{},data:i}))+"\n\n"+((s=n["if"].call(u,t!=null?t.isAlbumView:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))!=null?s:"")+"\n</div>\n"},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/attribution",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-follow",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showNoButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(4,i,0),data:i}))!=null?s:""},2:function(e,t,n,r,i){return""},4:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showUnblockButton:t,{name:"if",hash:{},fn:e.program(5,i,0),inverse:e.program(7,i,0),data:i}))!=null?s:""},5:function(e,t,n,r,i){return"			<button class='follow alt'>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNBLOCK"},data:i}))+"</button>\n"},7:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showFollowingButton:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.program(10,i,0),data:i}))!=null?s:""},8:function(e,t,n,r,i){return'				<button class="follow is-following mini"><span class="drop-icon">\u25be</span></button>\n'},10:function(e,t,n,r,i){return'				<button class="follow mini"></button>\n'},12:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isFluid:t,{name:"if",hash:{},fn:e.program(13,i,0),inverse:e.program(23,i,0),data:i}))!=null?s:""},13:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showNoButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(14,i,0),data:i}))!=null?s:""},14:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showUnblockButton:t,{name:"if",hash:{},fn:e.program(15,i,0),inverse:e.program(17,i,0),data:i}))!=null?s:""},15:function(e,t,n,r,i){return"				<button class='follow alt'>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.UNBLOCK"},data:i}))+"</button>\n"},17:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showFollowingButton:t,{name:"if",hash:{},fn:e.program(18,i,0),inverse:e.program(21,i,0),data:i}))!=null?s:""},18:function(e,t,n,r,i){var s,o=t!=null?t:{};return'					<button class="follow is-following '+((s=n["if"].call(o,t!=null?t.isOnDark:t,{name:"if",hash:{},fn:e.program(19,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:t!=null?t.followingIntlKey:t},data:i}))+'<span class="drop-icon">\u25be</span></button>\n'},19:function(e,t,n,r,i){return"white"},21:function(e,t,n,r,i){var s,o=t!=null?t:{};return'					<button class="follow '+((s=n["if"].call(o,t!=null?t.isOnDark:t,{name:"if",hash:{},fn:e.program(19,i,0),inverse:e.noop,data:i}))!=null?s:"")+'">'+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(o,{name:"intlMessage",hash:{intlName:t!=null?t.followIntlKey:t},data:i}))+"</button>\n"},23:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showNoButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(24,i,0),data:i}))!=null?s:""},24:function(e,t,n,r,i){var s;return'			<span class="relationship">\n'+((s=n["if"].call(t!=null?t:{},t!=null?t.showUnblockButton:t,{name:"if",hash:{},fn:e.program(2,i,0),inverse:e.program(25,i,0),data:i}))!=null?s:"")+"			</span>\n"},25:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.showFollowingButton:t,{name:"if",hash:{},fn:e.program(26,i,0),inverse:e.program(28,i,0),data:i}))!=null?s:""},26:function(e,t,n,r,i){return"						<button class='unfluid follow is-following ui-button ui-button-icon ui-button-transparent ui-button-dropdown'><span>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.FOLLOWING"},data:i}))+"</span></button>\n"},28:function(e,t,n,r,i){return"						<button class='unfluid follow ui-button ui-button-icon'><span>"+e.escapeExpression((n.intlMessage||t&&t.intlMessage||n.helperMissing).call(t!=null?t:{},{name:"intlMessage",hash:{intlName:"common.FOLLOW"},data:i}))+"</span></button>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s;return(s=n["if"].call(t!=null?t:{},t!=null?t.isOnMobile:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(12,i,0),data:i}))!=null?s:""},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/follow",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
